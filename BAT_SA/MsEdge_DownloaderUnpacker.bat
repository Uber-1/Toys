@echo off
@title MsEdge downloader + unpacker + configer + self-updater ^| ver.1.0.1 [15.05.2025]
@cd /d "%~dp0"
@md MsEdge
@cd MsEdge

@echo.
@echo Download...
::@set MSEDGEVERNUMS=109.0.1518.78
@for /f "eol=- tokens=1-26 delims=.() " %%a in ('@curl.exe -lsL "https://www.catalog.update.microsoft.com/Search.aspx?q=edge-stable-x86" ^| @FINDSTR /IRC:"Microsoft Edge-Stable Channel"') do (@if NOT DEFINED MSEDGEVERNUMS (@set MSEDGEVERNUMS=%%l.%%m.%%n.%%o))
@echo MS Edge %MSEDGEVERNUMS%
@for /f "tokens=1* usebackq" %%a in (` @powershell -Command " (Invoke-RestMethod -Method 'Post' -Uri 'https://msedge.api.cdp.microsoft.com/api/v1.1/internal/contents/Browser/namespaces/Default/names/msedge-stable-win-x86/versions/%MSEDGEVERNUMS%/files?action=GenerateDownloadInfo&foregroundPriority=true')[0].Url " `) do (@set EdgUrl32=%%a)
@for /f "tokens=1* usebackq" %%a in (` @powershell -Command " ((Invoke-RestMethod -Method 'Post' -Uri 'https://msedge.api.cdp.microsoft.com/api/v1.1/internal/contents/Browser/namespaces/Default/names/msedge-stable-win-x64/versions/%MSEDGEVERNUMS%/files?action=GenerateDownloadInfo&foregroundPriority=true') | ? FileId -eq 'MicrosoftEdge_X64_%MSEDGEVERNUMS%.exe').Url " `) do (@set EdgUrl64=%%a)
@powershell -Command "(New-Object Net.WebClient).DownloadFile('%EdgUrl32%', 'Edge-x86.exe.7z')"
@powershell -Command "(New-Object Net.WebClient).DownloadFile('%EdgUrl64%', 'Edge-x64.exe.7z')"
@powershell -Command "(New-Object Net.WebClient).DownloadFile('https://www.7-zip.org/a/7zr.exe', '7zr.exe')"

@echo.
@echo Unpack...
@set excllist=-xr!"*Locales\a*.pak" -xr!"*Locales\b*.pak" -xr!"*Locales\c*.pak" -xr!"*Locales\d*.pak" -xr!"*Locales\e?.pak" -xr!en-GB.pak -xr!"*Locales\es*.pak" -xr!"*Locales\f*.pak" -xr!"*Locales\g*.pak" -xr!"*Locales\h*.pak" -xr!"*Locales\i*.pak" -xr!"*Locales\j*.pak" -xr!"*Locales\k*.pak" -xr!"*Locales\l*.pak" -xr!"*Locales\m*.pak" -xr!"*Locales\n*.pak" -xr!"*Locales\o*.pak" -xr!"*Locales\p*.pak" -xr!"*Locales\q*.pak" -xr!"*Locales\ro.pak" -xr!"*Locales\s*.pak" -xr!"*Locales\t*.pak" -xr!"*Locales\u*.pak" -xr!"*Locales\v*.pak" -xr!"*Locales\w*.pak" -xr!"*Locales\z*.pak"
@7zr.exe x -t7z -bso0 -aoa "Edge-x86.exe.7z" -o"." &&@7zr.exe rn -bso0 -aoa "MSEDGE.7z" Chrome-bin Edge-win32 &&@7zr.exe x -bso0 -aoa MSEDGE.7z %excllist% &&@del /f /q MSEDGE.7z Edge-x86.exe.7z
@7zr.exe x -t7z -bso0 -aoa "Edge-x64.exe.7z" -o"." &&@7zr.exe rn -bso0 -aoa "MSEDGE.7z" Chrome-bin Edge-win64 &&@7zr.exe x -bso0 -aoa MSEDGE.7z %excllist% &&@del /f /q MSEDGE.7z Edge-x64.exe.7z

@echo.
@echo Config...
@MD "UserData\Default\"
@set cr_masp1={"distribution":{"alternate_shortcut_text":false,"chrome_shortcut_icon_index":0,"create_all_shortcuts":true,"do_not_create_desktop_shortcut":true,"do_not_create_quick_launch_shortcut":true,"do_not_create_taskbar_shortcut":true,"do_not_launch_chrome":true,"do_not_register_for_update_launch":true,"import_bookmarks":false,"import_history":false,"import_home_page":false,"import_search_engine":false,"make_chrome_default":false,"make_chrome_default_for_user":false,"show_welcome_page":false,"skip_first_run_ui":true,"system_level":false,"verbose_logging":false},"first_run_tabs":[],"homepage":"chrome://chrome-urls","homepage_is_newtabpage":false,"safebrowsing":{"enabled":false},"session":{"restore_on_startup":1},"alternate_error_pages":{"backup":true,"enabled":false},"autocomplete":{"retention_policy_last_version":114},"autofill":{"autostuff_enabled":false,"credit_card_enabled":false,"custom_data_enabled":false,"enabled":false,"orphan_rows_removed":true,"profile_enabled":false},"bookmark_bar":{"show_apps_shortcut":false,"show_on_all_tabs":false,"show_only_on_ntp":true,"show_reading_list":false},"browser":{"show_home_button":true,"clear_data":{"download_history":true,"edge_uwp_browsing_data":true,"form_data":true,"mf_protected_media_data":true,"on_exit_succeeded":true,"passwords":true,"site_settings":true,"time_period":4},"clear_data_on_exit":{"cache":true,"download_history":true,"form_data":true,"hosted_apps_data":false,"passwords":false},"clear_lso_data_enabled":true,"enable_text_prediction_v2":false,"has_seen_welcome_page":false,"last_clear_browsing_data_tab":1,"should_reset_check_default_browser":false,"show_discover_toolbar_button":false,"show_hub_app_in_sidebar_buttons":{"0c835d2d-9592-4c7a-8d0a-0e283c9ad3cd":3,"2354565a-f412-4654-b89c-f92eaa9dbd20":0,"523b5ef3-0b10-4154-8b62-10b2ebd00921":3,"64be4f9b-3b81-4b6e-b354-0ba00d6ba485":3,"8682d0fa-50b3-4ece-aa5b-e0b33f9919e2":3,"8ac719c5-140b-4bf2-a0b7-c71617f1f377":3,"92f1b743-e26b-433b-a1ec-912d1f0ad1fa":3,"96defd79-4015-4a32-bd09-794ff72183ef":3,"9ce3c9c2-462f-4cc9-bbd7-57d656445be0":3,"cd4688a9-e888-48ea-ad81-76193d56b1be":0},"show_hub_apps_tower":false,"show_hub_apps_tower_pinned":false,"show_hub_popup_on_download_start":true,"show_hubapps_personalization":false,"show_sidebar_notification":false,"show_sidebar_notification_preferred":false,"show_tab_preview":false,"show_text_in_pill":false,"show_toolbar_bookmarks_button":false,"show_toolbar_browser_essentials_button":0,"show_toolbar_citations_button":false,"show_toolbar_collections_button":false,"show_toolbar_downloads_button":true,"show_toolbar_edge_generic_sidebar_button":false,"show_toolbar_performance_button":0,"show_toolbar_share_button":false,"show_toolbar_vertical_tabs_button":false,"toolbar_browser_essentials_button_pinned":false,"toolbar_extensions_hub_button_visibility":0,"underside_chat_bing_signed_in_status":false,"window_placement":{"bottom":640,"left":32,"maximized":true,"right":1024,"top":32}},"browser_essentials":{"show_hub_fre":false,"show_safety_fre":false},"caretbrowsing":{"enabled":false},"collections":{"fre_seen":true},"credentials_enable_autofill_passwords":false,"credentials_enable_autosignin":false,"credentials_enable_service":false,"default_apps_install_state":2,"download":{"allow_office_viewer_for_download":false,"directory_upgrade":true,"prompt_for_download":true},"dual_engine":{"shared_cookie_data":{},"sitelist_data":{},"sitelist_location":"","sitelist_version":""},"edge":{"show_minimised_pip_overlay":true,"vertical_tabs":{"feedback_do_not_show":true,"first_opened2":true,"hide_titlebar":false,"opened":false}},"edge_enhance_images_enabled":false,"edge_follow_enabled":false,"edge_follow_notification_enabled":false,"edge_quick_search":{"open_search_in_new_tab_only":true,"show_mini_menu":false,"show_smart_actions_in_full_menu":true},"edge_rewards":{"opened_via_prototocol_launch":false,"show":false},"edge_share":{"enhanced_copy_paste":{"default_url_format":1}},"edge_shopping_assistant_enabled":false,"edge_tab_services_enabled":false,"edge_underside_triggering_enabled":false,"family_safety":{"activity_reporting_enabled":false,"web_filtering_enabled":false},"localsuggest":{"enabled":false},"media":{"edge_autoplay_behavior":2,"engagement":{"schema_version":4}},"net":{"network_prediction_options":2},"ntp":{"background_image_type":"off","enable_prerender":false,"hide_default_top_sites":true,"layout_mode":3,"news_feed_display":"off","num_personal_suggestions":1,"quick_links_options":0,"show_greeting":false,"show_image_of_day":false,"show_settings":false,"show_top_sites":false,"user_nurturing":[]},"omnibox":{"prevent_url_elisions":true},"payments":{"can_make_payment_enabled":false},"previews":{"litepage":{"user-needs-notification":false},"offline_helper":{"available_pages":{}}},"profile":{"avatar_index":20,"block_third_party_cookies":true,"content_settings":{"clear_on_exit_migrated":true,"exceptions":{},"pref_version":1},"default_content_setting_values":{"background_sync":2,"cookies":1},"exit_type":"Normal","exited_cleanly":true,"has_seen_signin_fre":true,"icon_version":15,"local_avatar_index":24,"managed_user_id":"","name":"","password_manager_enabled":false},"search":{"suggest_enabled":false},"spellcheck":{"use_spelling_service":false},"translate":{"enabled":false},"user_experience_metrics":{"personalization_data_consent_enabled":false,"personalization_data_consent_enabled_last_known_value":false},"video_enhancement":{"enabled":false,"mode":"Non-AI enhancement"}}
@set cr_loca1={"background_mode":{"enabled":false},"browser":{"enabled_labs_experiments":["edge-autoplay-user-setting-block-option@1","edge-enhance-text-contrast@1","ignore-gpu-blocklist","smooth-scrolling@2"]},"edge":{"perf_center":{"efficiency_mode_v2_is_active":false,"perf_game_mode":true,"performance_mode":0,"performance_mode_is_on":true,"performance_mode_toggled":true}},"experimentation_and_configuration_service_control":2,"fire_local_softlanding_notification":false,"fre":{"has_user_committed_selection_to_import_during_fre":false,"has_user_completed_fre":true,"has_user_seen_fre":true,"oem_bookmarks_set":true,"screens":["Microsoft.NewProfileFRE.ScreenId.SyncSignin"],"soft_landing_bubble":{"bubble_response":0,"has_user_seen_bubble":true,"is_bubble_triggered":0}},"hardware_acceleration_mode_previous":true,"is_dsp_recommended":false,"phoenix":{"rounded_frame_enabled":false},"profile":{"info_cache":{"Default":{"avatar_icon":"chrome://theme/IDR_PROFILE_AVATAR_20","background_apps":false,"edge_account_first_name":"","edge_account_last_name":"","edge_account_oid":"","edge_account_tenant_id":"","edge_account_type":0,"edge_kids_mode":false,"edge_test_on_premises":false,"edge_wam_aad_for_app_account_type":0,"force_signin_profile_locked":false,"gaia_given_name":"","gaia_id":"","gaia_name":"","hosted_domain":"","is_consented_primary_account":false,"is_ephemeral":false,"is_omitted_from_profile_list":false,"is_using_default_avatar":true,"is_using_default_name":true,"local_auth_credentials":"","managed_user_id":"","metrics_bucket_index":1,"name":"Default","shortcut_name":"Profile 1","signin.with_credential_provider":false,"user_name":""}},"last_active_profiles":[],"metrics":{"next_bucket_index":2}},"profile_network_context_service":{"http_cache_finch_experiment_groups":"None None None"},"site_safety_services":{"enabled":false},"smartscreen":{"enabled":true,"pua_protection_enabled":false},"startup_boost":{"default_last_launch":true,"enabled":false},"subresource_filter":{"ruleset_version":{"checksum":0,"content":"","format":0}}}
@set cr_pref1={"alternate_error_pages":{"backup":true,"enabled":false},"autocomplete":{"retention_policy_last_version":114},"autofill":{"autostuff_enabled":false,"credit_card_enabled":false,"custom_data_enabled":false,"orphan_rows_removed":true,"profile_enabled":false},"bookmark_bar":{"show_on_all_tabs":false,"show_only_on_ntp":true},"browser":{"available_dark_theme_options":"All","clear_data":{"download_history":true,"edge_uwp_browsing_data":true,"form_data":true,"mf_protected_media_data":true,"on_exit_succeeded":true,"passwords":true,"site_settings":true,"time_period":4},"clear_data_on_exit":{"cache":true,"download_history":true,"form_data":true,"hosted_apps_data":false,"passwords":false},"enable_text_prediction_v2":false,"has_seen_welcome_page":false,"should_reset_check_default_browser":false,"show_discover_toolbar_button":false,"show_hub_app_in_sidebar_buttons":{"0c835d2d-9592-4c7a-8d0a-0e283c9ad3cd":3,"2354565a-f412-4654-b89c-f92eaa9dbd20":0,"523b5ef3-0b10-4154-8b62-10b2ebd00921":3,"64be4f9b-3b81-4b6e-b354-0ba00d6ba485":3,"8682d0fa-50b3-4ece-aa5b-e0b33f9919e2":3,"8ac719c5-140b-4bf2-a0b7-c71617f1f377":3,"92f1b743-e26b-433b-a1ec-912d1f0ad1fa":3,"96defd79-4015-4a32-bd09-794ff72183ef":3,"9ce3c9c2-462f-4cc9-bbd7-57d656445be0":3,"cd4688a9-e888-48ea-ad81-76193d56b1be":0},"show_hub_apps_tower":false,"show_hub_apps_tower_pinned":false,"show_hub_popup_on_download_start":true,"show_hubapps_personalization":false,"show_sidebar_notification":false,"show_sidebar_notification_preferred":false,"show_tab_preview":false,"show_text_in_pill":false,"show_toolbar_bookmarks_button":false,"show_toolbar_browser_essentials_button":0,"show_toolbar_citations_button":false,"show_toolbar_collections_button":false,"show_toolbar_downloads_button":true,"show_toolbar_edge_generic_sidebar_button":false,"show_toolbar_performance_button":0,"show_toolbar_share_button":false,"show_toolbar_vertical_tabs_button":false,"toolbar_browser_essentials_button_pinned":false,"toolbar_extensions_hub_button_visibility":0,"underside_chat_bing_signed_in_status":false,"window_placement":{"bottom":640,"left":32,"maximized":true,"right":1024,"top":32}},"browser_essentials":{"show_hub_fre":false,"show_safety_fre":false},"caretbrowsing":{"enabled":false},"collections":{"fre_seen":true},"credentials_enable_autofill_passwords":false,"credentials_enable_autosignin":false,"credentials_enable_service":false,"download":{"allow_office_viewer_for_download":false,"default_directory":"D:\\Downloads","directory_upgrade":true,"prompt_for_download":true},"dual_engine":{"shared_cookie_data":{},"sitelist_data":{},"sitelist_location":"","sitelist_version":""},"edge":{"show_minimised_pip_overlay":true,"vertical_tabs":{"feedback_do_not_show":true,"first_opened2":true,"hide_titlebar":false,"opened":false}},"edge_enhance_images_enabled":false,"edge_follow_enabled":false,"edge_follow_notification_enabled":false,"edge_quick_search":{"open_search_in_new_tab_only":true,"show_mini_menu":false,"show_smart_actions_in_full_menu":true},"edge_rewards":{"opened_via_prototocol_launch":false,"show":false},"edge_share":{"enhanced_copy_paste":{"default_url_format":1}},"edge_shopping_assistant_enabled":false,"edge_tab_services_enabled":false,"edge_underside_triggering_enabled":false,"family_safety":{"activity_reporting_enabled":false,"web_filtering_enabled":false},"localsuggest":{"enabled":false},"media":{"edge_autoplay_behavior":2,"engagement":{"schema_version":4}},"ntp":{"background_image_type":"off","enable_prerender":false,"hide_default_top_sites":true,"layout_mode":3,"news_feed_display":"off","num_personal_suggestions":1,"quick_links_options":0,"show_greeting":false,"show_image_of_day":false,"show_settings":false,"show_top_sites":false,"user_nurturing":[{"key":"campaigns","value":[]},{"key":"meta","value":{"campaignsDataMigrationDoneTs":1613484653685}}]},"payments":{"can_make_payment_enabled":false},"previews":{"litepage":{"user-needs-notification":false},"offline_helper":{"available_pages":{}}},"profile":{"avatar_bubble_tutorial_shown":2,"avatar_index":20,"content_settings":{"exceptions":{},"pref_version":1},"exit_type":"Normal","exited_cleanly":true,"has_seen_signin_fre":true,"icon_version":15,"managed_user_id":"","name":"1","password_manager_onboarding_state":1,"were_old_google_logins_removed":true},"reset_prepopulated_engines":false,"signin":{"DiceMigrationComplete":true,"allowed":true},"spellcheck":{"use_spelling_service":false},"translate":{"enabled":false},"try_collections_first_time":true,"unified_consent":{"migration_state":10},"user_experience_metrics":{"personalization_data_consent_enabled":false,"personalization_data_consent_enabled_last_known_value":false},"video_enhancement":{"enabled":false,"mode":"Non-AI enhancement"}}
(@echo %cr_masp1%)>"Edge-win32\%MSEDGEVERNUMS%\master_preferences"
(@echo %cr_masp1%)>"Edge-win64\%MSEDGEVERNUMS%\master_preferences"
@if not exist "UserData\Local State" (@echo %cr_loca1%)>"UserData\Local State"
@if not exist "UserData\Default\Preferences" (@echo %cr_pref1%)>"UserData\Default\Preferences"
@SET ChrCmLnParam=--disable-gpu-shader-disk-cache --disk-cache-dir=nul --disk-cache-size=1 --disable-background-networking --disable-component-update --no-default-browser-check --disable-breakpad --disable-crash-reporter --disable-databases --disable-default-apps --disable-file-system --disable-local-storage --no-pings --enable-features=MainThreadCompositingPriority,OverlayScrollbar --disable-features=PreloadMediaEngagementData,MediaEngagementBypassAutoplayPolicies,RecordMediaEngagementScores,RecordWebAudioEngagement --disable_d3d11_video_decoder=0
(@echo @cd Edge-win32\%MSEDGEVERNUMS%\ &@echo @start msedge.exe --user-data-dir=..\..\UserData %ChrCmLnParam%)>"Edge %MSEDGEVERNUMS% [32-bit] Launcher.bat"
(@echo @cd Edge-win64\%MSEDGEVERNUMS%\ &@echo @start msedge.exe --user-data-dir=..\..\UserData %ChrCmLnParam%)>"Edge %MSEDGEVERNUMS% [64-bit] Launcher.bat"

@echo.
@echo Done!
@pause > nul